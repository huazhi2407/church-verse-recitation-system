rules_version = '2';

// 教會經文背誦系統 Firestore 安全規則

service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow create, update, delete: if false;
    }

    match /counters/{doc} {
      allow read, write: if false;
    }

    // 當週經文：所有登入者可讀；僅管理員可寫、可刪
    match /weeklyVerses/{weekId} {
      allow read: if request.auth != null;
      allow create, update, delete: if request.auth != null
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }

    // 簽到記錄：本人可讀寫；管理員可讀全部（用於過曆表格）
    match /checkins/{userId}/weeks/{weekId} {
      allow read: if request.auth != null
        && (request.auth.uid == userId
          || get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    match /{document=**} {
      allow read, write: if false;
    }
  }
}
